<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Calorie Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #0f172a;
      --bg-card: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.12);
      --accent-strong: rgba(34, 197, 94, 0.4);
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --border: #1f2937;
      --danger: #ef4444;
      --danger-soft: rgba(239, 68, 68, 0.12);
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.45);
      --shadow-sm: 0 10px 25px rgba(0, 0, 0, 0.3);
      --input-bg: #020617;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, #020617 42%, #020617 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .app-shell {
      width: 100%;
      max-width: 1120px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 4px 2px;
    }

    .app-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .app-title h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      font-size: 0.65rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .app-title span {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    main {
      display: grid;
      grid-template-columns: 1.1fr 1.1fr;
      gap: 16px;
      align-items: flex-start;
    }

    .card {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.96), #020617);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(51, 65, 85, 0.8);
      box-shadow: var(--shadow-soft);
      padding: 14px 14px 12px;
      backdrop-filter: blur(16px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
    }

    .card-header h2 {
      margin: 0;
      font-size: 0.95rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .card-header small {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .chip {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.8);
      font-size: 0.7rem;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chip-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle, var(--accent) 0, #166534 55%, transparent 60%);
    }

    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .stat-tile {
      background: radial-gradient(circle at top left, var(--accent-soft), #020617);
      border-radius: 14px;
      border: 1px solid rgba(30, 64, 175, 0.65);
      padding: 8px 10px;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    .stat-tile.secondary {
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.08), #020617);
      border-color: rgba(51, 65, 85, 0.9);
    }

    .stat-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 600;
      display: inline-flex;
      align-items: baseline;
      gap: 4px;
    }

    .stat-value span.unit {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .stat-sub {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .goal-input-row {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) auto;
      gap: 10px;
      margin-bottom: 8px;
      align-items: center;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .field input,
    .field select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: var(--input-bg);
      color: var(--text);
      font-size: 0.85rem;
      outline: none;
      transition: border 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
    }

    .field input:focus,
    .field select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-strong);
    }

    .field input[type="number"]::-webkit-inner-spin-button,
    .field input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .field input[type="number"] {
      -moz-appearance: textfield;
    }

    .btn {
      border-radius: 999px;
      padding: 8px 14px;
      border: none;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
    }

    .btn-primary {
      background: radial-gradient(circle at top, var(--accent), #16a34a);
      color: #022c22;
      box-shadow: 0 12px 25px var(--accent-strong);
    }

    .btn-primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 5px 12px rgba(34, 197, 94, 0.45);
    }

    .btn-muted {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-muted);
      border: 1px solid rgba(55, 65, 81, 0.9);
      box-shadow: none;
    }

    .btn-muted:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.9);
    }

    .btn-icon {
      border-radius: 999px;
      padding: 5px 8px;
      font-size: 0.7rem;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-danger {
      background: var(--danger-soft);
      color: #fecaca;
      border-color: rgba(239, 68, 68, 0.7);
    }

    .btn-danger:hover {
      background: rgba(248, 113, 113, 0.18);
    }

    .date-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .date-picker {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .date-picker input[type="date"] {
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 5px 8px;
      background: var(--input-bg);
      color: var(--text);
      font-size: 0.8rem;
      outline: none;
    }

    .entries-list {
      max-height: 360px;
      overflow-y: auto;
      padding-right: 4px;
      margin: 0 -6px 0 0;
    }

    .entry {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) 0.9fr auto;
      gap: 6px;
      align-items: center;
      padding: 7px 8px;
      margin-bottom: 5px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(30, 64, 175, 0.4);
    }

    .entry-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .entry-name {
      font-size: 0.85rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .entry-meta {
      font-size: 0.7rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .entry-calories {
      font-size: 0.9rem;
      font-weight: 500;
      text-align: right;
    }

    .entry-actions {
      display: flex;
      justify-content: flex-end;
      gap: 4px;
    }

    .badge {
      border-radius: 999px;
      padding: 1px 7px;
      font-size: 0.65rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-muted);
    }

    .badge-type {
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .legend-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
      justify-content: flex-end;
    }

    .legend-item {
      font-size: 0.7rem;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .legend-swatch {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .swatch-consumed {
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
    }

    .swatch-remaining {
      background: radial-gradient(circle at top left, #38bdf8, #0284c7);
    }

    .progress-ring {
      position: relative;
      width: 120px;
      height: 120px;
      flex-shrink: 0;
    }

    .progress-ring svg {
      transform: rotate(-90deg);
    }

    .progress-ring circle {
      transition: stroke-dashoffset 0.3s ease;
    }

    .progress-center {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .progress-main {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .progress-sub {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .progress-badge {
      font-size: 0.7rem;
      border-radius: 999px;
      padding: 2px 8px;
      margin-top: 4px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: rgba(15, 23, 42, 0.9);
    }

    .alert {
      font-size: 0.75rem;
      border-radius: 12px;
      padding: 6px 8px;
      margin-top: 6px;
      display: flex;
      align-items: flex-start;
      gap: 6px;
    }

    .alert-info {
      background: rgba(37, 99, 235, 0.08);
      border: 1px solid rgba(37, 99, 235, 0.3);
      color: #bfdbfe;
    }

    .alert-danger {
      background: var(--danger-soft);
      border: 1px solid rgba(248, 113, 113, 0.7);
      color: #fecaca;
    }

    .alert-icon {
      font-size: 0.9rem;
      line-height: 1;
    }

    .alert p {
      margin: 0;
    }

    .empty-state {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
      padding: 16px 12px 6px;
    }

    .form-row {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) 0.9fr 0.9fr auto;
      gap: 8px;
      margin-bottom: 10px;
    }

    .divider {
      border-top: 1px dashed rgba(51, 65, 85, 0.9);
      margin: 8px 0;
    }

    .footer-note {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-align: right;
      padding: 0 4px 2px;
    }

    /* Scrollbar (webkit) */
    .entries-list::-webkit-scrollbar {
      width: 4px;
    }

    .entries-list::-webkit-scrollbar-track {
      background: transparent;
    }

    .entries-list::-webkit-scrollbar-thumb {
      background: rgba(75, 85, 99, 0.8);
      border-radius: 999px;
    }

    /* Responsiveness */
    @media (max-width: 900px) {
      main {
        grid-template-columns: 1.1fr;
      }

      .progress-ring {
        width: 100px;
        height: 100px;
      }

      .stats-row {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      body {
        padding: 10px;
      }

      .card {
        padding: 12px 11px 10px;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .app-title h1 {
        font-size: 1.15rem;
      }

      main {
        gap: 12px;
      }

      .form-row {
        grid-template-columns: minmax(0, 1.6fr) 0.9fr;
        grid-template-rows: auto auto;
        grid-auto-flow: dense;
      }

      .form-row .field:nth-child(3) {
        grid-column: 1 / 2;
      }

      .form-row .btn-primary {
        grid-column: 2 / 3;
        grid-row: 2 / 3;
        justify-self: stretch;
      }

      .entry {
        grid-template-columns: minmax(0, 1.7fr) 0.9fr;
        grid-template-rows: auto auto;
      }

      .entry-actions {
        grid-column: 1 / -1;
        justify-content: flex-start;
      }

      .stats-row {
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.2fr);
      }
    }

    @media (min-width: 1200px) {
      .app-shell {
        padding-top: 6px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="app-title">
        <h1>
          Calorie Tracker
          <span class="pill">Offline · Local Storage</span>
        </h1>
        <span>Quickly log meals and see your daily intake across phone, tablet, and desktop.</span>
      </div>
      <button id="resetAllBtn" class="btn btn-muted" type="button">
        <span>Reset all data</span>
      </button>
    </header>

    <main>
      <!-- Left: summary & goal -->
      <section class="card">
        <div class="card-header">
          <h2>Today · Overview</h2>
          <div class="chip">
            <span class="chip-dot"></span>
            <span id="currentDateLabel"></span>
          </div>
        </div>

        <div class="goal-input-row">
          <div class="field">
            <label for="dailyGoal">Daily calorie goal</label>
            <input
              id="dailyGoal"
              type="number"
              min="0"
              inputmode="numeric"
              placeholder="e.g. 2200"
            />
          </div>
          <button id="saveGoalBtn" class="btn btn-primary" type="button">
            <span>Save goal</span>
          </button>
        </div>

        <div class="stats-row">
          <div class="stat-tile">
            <div class="stat-label">Consumed</div>
            <div class="stat-value">
              <span id="statConsumed">0</span>
              <span class="unit">kcal</span>
            </div>
            <div class="stat-sub" id="statConsumedCount">0 entries</div>
          </div>
          <div class="stat-tile secondary">
            <div class="stat-label">Remaining</div>
            <div class="stat-value">
              <span id="statRemaining">0</span>
              <span class="unit">kcal</span>
            </div>
            <div class="stat-sub" id="statRemainingHint">Set a goal to see remaining</div>
          </div>
          <div class="stat-tile secondary">
            <div class="stat-label">Balance</div>
            <div class="stat-value">
              <span id="statBalance">0</span>
              <span class="unit">kcal</span>
            </div>
            <div class="stat-sub" id="statBalanceHint">Goal − Consumed</div>
          </div>
        </div>

        <div style="display: flex; align-items: center; gap: 12px; margin-top: 6px;">
          <div class="progress-ring">
            <svg width="120" height="120">
              <defs>
                <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#22c55e" />
                  <stop offset="50%" stop-color="#16a34a" />
                  <stop offset="100%" stop-color="#0ea5e9" />
                </linearGradient>
              </defs>
              <circle
                cx="60"
                cy="60"
                r="48"
                stroke="rgba(30,64,175,0.65)"
                stroke-width="8"
                fill="none"
              ></circle>
              <circle
                id="progressCircle"
                cx="60"
                cy="60"
                r="48"
                stroke="url(#progressGradient)"
                stroke-width="8"
                stroke-linecap="round"
                fill="none"
                stroke-dasharray="301.59"
                stroke-dashoffset="301.59"
              ></circle>
            </svg>
            <div class="progress-center">
              <div class="progress-main" id="progressPercent">0%</div>
              <div class="progress-sub" id="progressLabel">of daily goal</div>
              <div class="progress-badge" id="progressBadge">Set a goal to begin</div>
            </div>
          </div>

          <div style="flex: 1; font-size: 0.8rem;">
            <div class="alert alert-info">
              <div class="alert-icon">ℹ</div>
              <p id="infoText">
                Your entries and goal are stored locally in this browser using
                <strong>localStorage</strong>.
              </p>
            </div>

            <div id="overGoalAlert" class="alert alert-danger" style="display: none;">
              <div class="alert-icon">!</div>
              <p id="overGoalText"></p>
            </div>

            <div class="legend-row">
              <div class="legend-item">
                <span class="legend-swatch swatch-consumed"></span>
                <span>Consumed</span>
              </div>
              <div class="legend-item">
                <span class="legend-swatch swatch-remaining"></span>
                <span>Remaining</span>
              </div>
            </div>
          </div>
        </div>

        <div class="footer-note">
          Tip: You can change the date on the right to review previous days.
        </div>
      </section>

      <!-- Right: log & list -->
      <section class="card">
        <div class="card-header">
          <h2>Log entries</h2>
          <div class="date-row">
            <div class="date-picker">
              <span>Day</span>
              <input id="datePicker" type="date" />
            </div>
            <button id="clearDayBtn" class="btn-icon btn-danger" type="button">
              <span>Clear day</span>
            </button>
          </div>
        </div>

        <form id="entryForm" autocomplete="off">
          <div class="form-row">
            <div class="field">
              <label for="mealName">Meal / snack</label>
              <input
                id="mealName"
                type="text"
                placeholder="e.g. Chicken wrap"
                required
              />
            </div>
            <div class="field">
              <label for="mealCalories">Calories</label>
              <input
                id="mealCalories"
                type="number"
                min="0"
                inputmode="numeric"
                placeholder="kcal"
                required
              />
            </div>
            <div class="field">
              <label for="mealType">Type</label>
              <select id="mealType">
                <option value="meal">Meal</option>
                <option value="snack">Snack</option>
                <option value="drink">Drink</option>
              </select>
            </div>
            <button class="btn btn-primary" type="submit">
              <span>+ Add</span>
            </button>
          </div>
        </form>

        <div class="divider"></div>

        <div id="entriesList" class="entries-list"></div>
        <div id="emptyState" class="empty-state">
          No entries for this day yet. Add your first meal above.
        </div>
      </section>
    </main>
  </div>

  <script>
    (function () {
      const STORAGE_KEY = "calorieTrackerData_v1";

      function loadData() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) {
            return { goal: null, entries: [] };
          }
          const parsed = JSON.parse(raw);
          if (
            typeof parsed !== "object" ||
            !("entries" in parsed) ||
            !Array.isArray(parsed.entries)
          ) {
            return { goal: null, entries: [] };
          }
          return {
            goal: typeof parsed.goal === "number" ? parsed.goal : null,
            entries: parsed.entries.map((e) => ({
              id: e.id || String(Math.random()),
              date: e.date,
              name: e.name,
              calories: Number(e.calories) || 0,
              type: e.type || "meal",
            })),
          };
        } catch (e) {
          console.warn("Failed to parse stored data, resetting.", e);
          return { goal: null, entries: [] };
        }
      }

      function saveData(data) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }

      const data = loadData();

      const dailyGoalInput = document.getElementById("dailyGoal");
      const saveGoalBtn = document.getElementById("saveGoalBtn");
      const resetAllBtn = document.getElementById("resetAllBtn");

      const statConsumedEl = document.getElementById("statConsumed");
      const statConsumedCountEl = document.getElementById("statConsumedCount");
      const statRemainingEl = document.getElementById("statRemaining");
      const statRemainingHintEl = document.getElementById("statRemainingHint");
      const statBalanceEl = document.getElementById("statBalance");
      const statBalanceHintEl = document.getElementById("statBalanceHint");

      const progressCircleEl = document.getElementById("progressCircle");
      const progressPercentEl = document.getElementById("progressPercent");
      const progressLabelEl = document.getElementById("progressLabel");
      const progressBadgeEl = document.getElementById("progressBadge");

      const infoTextEl = document.getElementById("infoText");
      const overGoalAlertEl = document.getElementById("overGoalAlert");
      const overGoalTextEl = document.getElementById("overGoalText");

      const currentDateLabelEl = document.getElementById("currentDateLabel");
      const datePickerEl = document.getElementById("datePicker");
      const clearDayBtn = document.getElementById("clearDayBtn");

      const entryForm = document.getElementById("entryForm");
      const mealNameInput = document.getElementById("mealName");
      const mealCaloriesInput = document.getElementById("mealCalories");
      const mealTypeSelect = document.getElementById("mealType");

      const entriesListEl = document.getElementById("entriesList");
      const emptyStateEl = document.getElementById("emptyState");

      const circleRadius = 48;
      const circleCircumference = 2 * Math.PI * circleRadius;

      function formatDateLabel(dateStr) {
        const date = new Date(dateStr + "T00:00");
        const todayStr = todayISO();
        if (dateStr === todayStr) return "Today";
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const dateIso = date.toISOString().slice(0, 10);
        if (dateIso === yesterday.toISOString().slice(0, 10)) return "Yesterday";
        if (dateIso === tomorrow.toISOString().slice(0, 10)) return "Tomorrow";

        return date.toLocaleDateString(undefined, {
          weekday: "short",
          month: "short",
          day: "numeric",
        });
      }

      function todayISO() {
        const d = new Date();
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        return year + "-" + month + "-" + day;
      }

      function setCurrentDate(dateStr) {
        datePickerEl.value = dateStr;
        currentDateLabelEl.textContent = formatDateLabel(dateStr);
      }

      function getSelectedDate() {
        return datePickerEl.value || todayISO();
      }

      function getEntriesForDate(dateStr) {
        return data.entries.filter((e) => e.date === dateStr);
      }

      function updateStatsAndUI() {
        const dateStr = getSelectedDate();
        const entries = getEntriesForDate(dateStr);
        const totalCalories = entries.reduce((sum, e) => sum + e.calories, 0);

        statConsumedEl.textContent = totalCalories.toString();
        statConsumedCountEl.textContent =
          entries.length === 1 ? "1 entry" : entries.length + " entries";

        if (typeof data.goal === "number" && data.goal > 0) {
          const remaining = Math.max(data.goal - totalCalories, 0);
          const balance = data.goal - totalCalories;
          statRemainingEl.textContent = remaining.toString();
          statRemainingHintEl.textContent =
            remaining === 0
              ? "Goal reached or exceeded"
              : "You can still consume " + remaining + " kcal";
          statBalanceEl.textContent = balance.toString();
          statBalanceHintEl.textContent =
            balance >= 0 ? "Under daily goal" : "Over daily goal";

          const progress =
            totalCalories <= 0
              ? 0
              : Math.min((totalCalories / data.goal) * 100, 200);
          const percentText = Math.round(
            Math.min((totalCalories / data.goal) * 100, 999)
          );
          const offset =
            circleCircumference * (1 - Math.min(progress / 100, 1));
          progressCircleEl.style.strokeDasharray = circleCircumference.toFixed(
            2
          );
          progressCircleEl.style.strokeDashoffset = offset.toFixed(2);

          progressPercentEl.textContent = percentText + "%";
          progressLabelEl.textContent = "of " + data.goal + " kcal goal";

          if (totalCalories === 0) {
            progressBadgeEl.textContent = "Start logging meals to see progress.";
          } else if (progress < 70) {
            progressBadgeEl.textContent = "Plenty of room remaining.";
          } else if (progress <= 100) {
            progressBadgeEl.textContent = "You're close to your daily goal.";
          } else {
            progressBadgeEl.textContent = "You've gone past today's goal.";
          }

          if (balance < 0) {
            overGoalTextEl.textContent =
              "You are " +
              Math.abs(balance) +
              " kcal over your daily goal for this day.";
            overGoalAlertEl.style.display = "flex";
          } else {
            overGoalAlertEl.style.display = "none";
          }

          infoTextEl.innerHTML =
            'Your entries and goal are stored locally in this browser using <strong>localStorage</strong>.';
        } else {
          statRemainingEl.textContent = "0";
          statRemainingHintEl.textContent = "Set a goal to see remaining";
          statBalanceEl.textContent = "0";
          statBalanceHintEl.textContent = "Goal − Consumed";

          progressCircleEl.style.strokeDasharray = circleCircumference.toFixed(
            2
          );
          progressCircleEl.style.strokeDashoffset =
            circleCircumference.toFixed(2);
          progressPercentEl.textContent = "0%";
          progressLabelEl.textContent = "of daily goal";
          progressBadgeEl.textContent = "Set a goal to begin";
          overGoalAlertEl.style.display = "none";

          infoTextEl.innerHTML =
            'Set a daily goal above. Everything stays in this browser using <strong>localStorage</strong>.';
        }

        renderEntries(dateStr);
      }

      function renderEntries(dateStr) {
        const entries = getEntriesForDate(dateStr);
        entriesListEl.innerHTML = "";
        if (entries.length === 0) {
          emptyStateEl.style.display = "block";
          return;
        }
        emptyStateEl.style.display = "none";

        entries
          .slice()
          .sort((a, b) => a.id.localeCompare(b.id))
          .forEach((entry) => {
            const div = document.createElement("div");
            div.className = "entry";

            const main = document.createElement("div");
            main.className = "entry-main";

            const nameSpan = document.createElement("span");
            nameSpan.className = "entry-name";
            nameSpan.textContent = entry.name || "(No description)";
            main.appendChild(nameSpan);

            const meta = document.createElement("div");
            meta.className = "entry-meta";

            const typeBadge = document.createElement("span");
            typeBadge.className = "badge badge-type";
            typeBadge.textContent = entry.type.toUpperCase();
            meta.appendChild(typeBadge);

            const idBadge = document.createElement("span");
            idBadge.className = "badge";
            idBadge.textContent = "ID " + entry.id.slice(-4);
            meta.appendChild(idBadge);

            main.appendChild(meta);

            const calSpan = document.createElement("div");
            calSpan.className = "entry-calories";
            calSpan.textContent = entry.calories + " kcal";

            const actions = document.createElement("div");
            actions.className = "entry-actions";

            const deleteBtn = document.createElement("button");
            deleteBtn.className = "btn-icon btn-danger";
            deleteBtn.type = "button";
            deleteBtn.textContent = "Delete";
            deleteBtn.addEventListener("click", function () {
              deleteEntry(entry.id);
            });

            actions.appendChild(deleteBtn);

            div.appendChild(main);
            div.appendChild(calSpan);
            div.appendChild(actions);

            entriesListEl.appendChild(div);
          });
      }

      function addEntry(name, calories, type, dateStr) {
        const entry = {
          id: Date.now().toString(36) + Math.random().toString(36).slice(2, 6),
          date: dateStr,
          name: name.trim(),
          calories: calories,
          type: type,
        };
        data.entries.push(entry);
        saveData(data);
        updateStatsAndUI();
      }

      function deleteEntry(id) {
        const idx = data.entries.findIndex((e) => e.id === id);
        if (idx === -1) return;
        data.entries.splice(idx, 1);
        saveData(data);
        updateStatsAndUI();
      }

      function clearDay(dateStr) {
        const remaining = data.entries.filter((e) => e.date !== dateStr);
        data.entries = remaining;
        saveData(data);
        updateStatsAndUI();
      }

      function init() {
        const today = todayISO();

        if (!data.entries.some((e) => e.date === today)) {
          const now = new Date();
          const hours = now.getHours();
          if (hours > 5 && hours < 11) {
            data.entries.push({
              id: "sample-" + Date.now().toString(36),
              date: today,
              name: "Sample breakfast",
              calories: 300,
              type: "meal",
            });
            saveData(data);
          }
        }

        if (typeof data.goal === "number" && data.goal > 0) {
          dailyGoalInput.value = data.goal.toString();
        }

        setCurrentDate(today);
        datePickerEl.value = today;
        updateStatsAndUI();
      }

      entryForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const name = mealNameInput.value.trim();
        const calories = Number(mealCaloriesInput.value);
        const type = mealTypeSelect.value || "meal";
        if (!name || !Number.isFinite(calories) || calories <= 0) {
          mealCaloriesInput.focus();
          return;
        }
        addEntry(name, calories, type, getSelectedDate());
        mealNameInput.value = "";
        mealCaloriesInput.value = "";
        mealNameInput.focus();
      });

      saveGoalBtn.addEventListener("click", function () {
        const value = dailyGoalInput.value.trim();
        if (!value) {
          data.goal = null;
        } else {
          const num = Number(value);
          if (!Number.isFinite(num) || num <= 0) {
            dailyGoalInput.focus();
            return;
          }
          data.goal = Math.round(num);
        }
        saveData(data);
        updateStatsAndUI();
      });

      datePickerEl.addEventListener("change", function () {
        const dateStr = getSelectedDate();
        if (!datePickerEl.value) {
          datePickerEl.value = dateStr;
        }
        currentDateLabelEl.textContent = formatDateLabel(dateStr);
        updateStatsAndUI();
      });

      clearDayBtn.addEventListener("click", function () {
        const dateStr = getSelectedDate();
        if (!getEntriesForDate(dateStr).length) return;
        if (
          confirm(
            "Delete all entries for " +
              formatDateLabel(dateStr) +
              "?\nThis cannot be undone."
          )
        ) {
          clearDay(dateStr);
        }
      });

      resetAllBtn.addEventListener("click", function () {
        if (
          confirm(
            "This will erase all logged entries and your saved goal from this browser. Continue?"
          )
        ) {
          localStorage.removeItem(STORAGE_KEY);
          const fresh = loadData();
          data.goal = fresh.goal;
          data.entries = fresh.entries;
          dailyGoalInput.value = "";
          setCurrentDate(todayISO());
          updateStatsAndUI();
        }
      });

      init();
    })();
  </script>
</body>
</html>

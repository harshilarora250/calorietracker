<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CalLog – Calorie Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-page: #f3f4f6;
      --bg-header: #ffffff;
      --bg-card: #ffffff;
      --bg-soft: #f9fafb;
      --border-subtle: #e5e7eb;
      --border-strong: #d1d5db;
      --accent: #16a34a;
      --accent-soft: rgba(22, 163, 74, 0.12);
      --accent-strong: rgba(22, 163, 74, 0.35);
      --danger: #dc2626;
      --danger-soft: rgba(220, 38, 38, 0.08);
      --text-main: #111827;
      --text-muted: #6b7280;
      --text-soft: #9ca3af;
      --radius-lg: 18px;
      --radius-md: 10px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.08);
      --shadow-header: 0 8px 20px rgba(15, 23, 42, 0.06);
      --shadow-card: 0 10px 30px rgba(15, 23, 42, 0.06);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: var(--bg-page);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 16px;
    }

    .app {
      width: 100%;
      max-width: 960px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* HEADER */

    header {
      background: var(--bg-header);
      border-radius: 16px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-header);
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .header-left {
      display: flex;
      gap: 12px;
      align-items: center;
      min-width: 0;
    }

    .logo {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: radial-gradient(circle at 0 0, #22c55e, #16a34a 45%, #0ea5e9 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.9rem;
      color: #ecfdf3;
      flex-shrink: 0;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 3px;
      min-width: 0;
    }

    .title-block h1 {
      margin: 0;
      font-size: 1.25rem;
      letter-spacing: 0.01em;
      display: flex;
      gap: 8px;
      align-items: center;
      white-space: nowrap;
    }

    .badge {
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      padding: 3px 8px;
      font-size: 0.7rem;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .title-block p {
      margin: 0;
      font-size: 0.8rem;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .btn {
      border-radius: 999px;
      padding: 7px 14px;
      border: 1px solid transparent;
      font-size: 0.82rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
      transition: background 0.12s ease, border-color 0.12s ease,
        transform 0.08s ease, box-shadow 0.08s ease, color 0.12s ease;
    }

    .btn-muted {
      background: #ffffff;
      color: var(--text-muted);
      border-color: var(--border-strong);
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.04);
    }

    .btn-muted:hover {
      background: var(--bg-soft);
    }

    .btn-muted:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #16a34a);
      border-color: var(--accent);
      color: #ecfdf3;
      box-shadow: 0 6px 16px var(--accent-strong);
    }

    .btn-primary:hover {
      filter: brightness(1.03);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 3px 8px var(--accent-strong);
    }

    .btn-icon {
      border-radius: 999px;
      padding: 4px 7px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      color: var(--text-muted);
      font-size: 0.7rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background 0.12s ease, border-color 0.12s ease,
        transform 0.08s ease, box-shadow 0.08s ease;
    }

    .btn-icon:hover {
      background: var(--bg-soft);
    }

    .btn-icon:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .btn-danger {
      background: #fef2f2;
      border-color: rgba(220, 38, 38, 0.35);
      color: #b91c1c;
    }

    .btn-danger:hover {
      background: #fee2e2;
    }

    /* ACCOUNT CARD */

    .account-card {
      background: var(--bg-card);
      border-radius: 16px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-card);
      padding: 12px 16px;
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.1fr);
      gap: 16px;
      align-items: start;
    }

    .account-section-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .account-status {
      font-size: 0.82rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .account-status strong {
      color: var(--text-main);
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      border: 1px solid var(--border-subtle);
      background: var(--bg-soft);
      color: var(--text-muted);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #f97316;
    }

    .status-dot.ok {
      background: #16a34a;
    }

    .auth-forms {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 12px;
    }

    .auth-form {
      border-radius: 12px;
      background: var(--bg-soft);
      border: 1px dashed var(--border-subtle);
      padding: 8px 10px 10px;
    }

    .auth-form h3 {
      margin: 0 0 4px;
      font-size: 0.86rem;
    }

    .auth-note {
      font-size: 0.72rem;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .auth-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 6px;
    }

    .auth-row label {
      font-size: 0.76rem;
      color: var(--text-soft);
    }

    .auth-row input {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      font-size: 0.8rem;
      color: var(--text-main);
      outline: none;
      transition: border-color 0.12s ease, box-shadow 0.12s ease;
    }

    .auth-row input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .auth-actions {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      align-items: center;
    }

    .auth-message {
      font-size: 0.74rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .auth-message.error {
      color: #b91c1c;
    }

    .auth-message.ok {
      color: #166534;
    }

    /* LAYOUT */

    main {
      display: grid;
      grid-template-columns: 1.05fr 1.05fr;
      gap: 16px;
      align-items: flex-start;
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-card);
      padding: 14px 16px 14px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
    }

    .card-header-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .card-header-main h2 {
      margin: 0;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
    }

    .card-header-main span {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .chip {
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      background: var(--bg-soft);
      padding: 4px 9px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.78rem;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .chip-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: radial-gradient(circle, var(--accent) 0, #15803d 55%, transparent 60%);
    }

    /* SUMMARY CARD */

    .goal-row {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) auto;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .field input,
    .field select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      color: var(--text-main);
      font-size: 0.85rem;
      outline: none;
      transition: border-color 0.12s ease, box-shadow 0.12s ease,
        background 0.12s ease;
    }

    .field input:focus,
    .field select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .field input[type="number"]::-webkit-inner-spin-button,
    .field input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .field input[type="number"] {
      -moz-appearance: textfield;
    }

    .stats-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 14px;
    }

    .stat {
      border-radius: 14px;
      background: var(--bg-soft);
      border: 1px solid var(--border-subtle);
      padding: 8px 10px;
    }

    .stat-label {
      font-size: 0.7rem;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 2px;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 600;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .stat-unit {
      font-size: 0.78rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .stat-sub {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .summary-layout {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .ring {
      width: 120px;
      height: 120px;
      position: relative;
      flex-shrink: 0;
    }

    .ring svg {
      transform: rotate(-90deg);
    }

    .ring circle {
      transition: stroke-dashoffset 0.25s ease;
    }

    .ring-center {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .ring-percent {
      font-size: 1.05rem;
      font-weight: 600;
    }

    .ring-label {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .ring-chip {
      font-size: 0.73rem;
      border-radius: 999px;
      padding: 2px 8px;
      margin-top: 4px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      color: var(--text-muted);
    }

    .info-stack {
      flex: 1;
      font-size: 0.8rem;
    }

    .alert {
      border-radius: 12px;
      padding: 6px 8px;
      margin-bottom: 6px;
      display: flex;
      align-items: flex-start;
      gap: 6px;
      font-size: 0.78rem;
    }

    .alert-icon {
      font-size: 0.9rem;
      line-height: 1;
      margin-top: 1px;
    }

    .alert-info {
      background: #eff6ff;
      border: 1px solid #dbeafe;
      color: #1d4ed8;
    }

    .alert-danger {
      background: var(--danger-soft);
      border: 1px solid rgba(220, 38, 38, 0.25);
      color: #b91c1c;
    }

    .legend-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
      color: var(--text-muted);
      font-size: 0.75rem;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .legend-swatch {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .swatch-consumed {
      background: #16a34a;
    }

    .swatch-remaining {
      background: #0ea5e9;
    }

    .footer-note {
      font-size: 0.72rem;
      color: var(--text-soft);
      margin-top: 8px;
      text-align: right;
    }

    /* LOG CARD */

    .date-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .date-picker {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .date-picker input[type="date"] {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 5px 8px;
      background: #ffffff;
      color: var(--text-main);
      font-size: 0.8rem;
      outline: none;
      transition: border-color 0.12s ease, box-shadow 0.12s ease;
    }

    .date-picker input[type="date"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
    }

    .text-muted {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    form {
      margin-top: 8px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) 0.9fr 0.9fr auto;
      gap: 8px;
      margin-bottom: 10px;
    }

    .divider {
      border-top: 1px dashed var(--border-subtle);
      margin: 8px 0;
    }

    .entries-list {
      max-height: 360px;
      overflow-y: auto;
      margin-right: -4px;
      padding-right: 4px;
    }

    .entry {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) 0.8fr auto;
      gap: 6px;
      align-items: center;
      padding: 7px 9px;
      margin-bottom: 6px;
      border-radius: 12px;
      background: var(--bg-soft);
      border: 1px solid var(--border-subtle);
    }

    .entry-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .entry-name {
      font-size: 0.86rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .entry-meta {
      font-size: 0.72rem;
      color: var(--text-soft);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .badge-pill {
      border-radius: 999px;
      padding: 1px 7px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .entry-calories {
      font-size: 0.9rem;
      font-weight: 600;
      text-align: right;
    }

    .entry-actions {
      display: flex;
      justify-content: flex-end;
      gap: 4px;
    }

    .empty {
      font-size: 0.8rem;
      color: var(--text-soft);
      text-align: center;
      padding: 18px 8px 4px;
    }

    .entries-list::-webkit-scrollbar {
      width: 4px;
    }

    .entries-list::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 999px;
    }

    .disabled-overlay {
      position: absolute;
      inset: 0;
      background: rgba(243, 244, 246, 0.7);
      border-radius: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      color: var(--text-muted);
      text-align: center;
      padding: 8px;
    }

    .relative {
      position: relative;
    }

    /* RESPONSIVE */

    @media (max-width: 900px) {
      .account-card {
        grid-template-columns: minmax(0, 1fr);
      }

      main {
        grid-template-columns: minmax(0, 1fr);
      }

      .summary-layout {
        align-items: flex-start;
      }
    }

    @media (max-width: 640px) {
      body {
        padding: 12px;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .title-block h1 {
        font-size: 1.1rem;
      }

      .card,
      .account-card {
        padding: 12px 12px 12px;
      }

      .summary-layout {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }

      .ring {
        margin: 0 auto;
      }

      .stats-row {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .auth-forms {
        grid-template-columns: minmax(0, 1fr);
      }

      .form-grid {
        grid-template-columns: minmax(0, 1.4fr) 0.9fr;
        grid-template-rows: auto auto;
      }

      .form-grid .field:nth-child(3) {
        grid-column: 1 / 2;
      }

      .form-grid .btn-primary {
        grid-column: 2 / 3;
        grid-row: 2 / 3;
        justify-self: stretch;
      }

      .entries-list {
        max-height: 280px;
      }

      .entry {
        grid-template-columns: minmax(0, 1.6fr) 0.8fr;
        grid-template-rows: auto auto;
      }

      .entry-actions {
        grid-column: 1 / -1;
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="header-left">
        <div class="logo">CL</div>
        <div class="title-block">
          <h1>
            CalLog
            <span class="badge">Firebase · Email sign-in</span>
          </h1>
          <p>Sign in, then log food; calories are estimated on-device.</p>
        </div>
      </div>
      <button id="resetAllBtn" class="btn btn-muted" type="button">
        Reset current day from my account
      </button>
    </header>

    <!-- ACCOUNT / AUTH -->
    <section class="account-card">
      <div>
        <div class="account-section-title">Account</div>
        <div class="account-status" id="accountStatus">
          Not signed in.
        </div>
        <div class="status-pill" id="verifyPill" style="display:none;">
          <span class="status-dot" id="verifyDot"></span>
          <span id="verifyLabel"></span>
        </div>
        <div class="auth-message" id="globalAuthMessage"></div>
        <div class="auth-actions" id="signedInActions" style="margin-top:8px; display:none;">
          <button id="signOutBtn" class="btn btn-muted" type="button">Sign out</button>
        </div>
      </div>

      <div class="auth-forms" id="authForms">
        <div class="auth-form" id="signUpFormWrapper">
          <h3>Create CalLog account</h3>
          <p class="auth-note">
            Email + password. A verification link is emailed to you
            (it may go to your <strong>Spam/Junk</strong> folder).
          </p>
          <div class="auth-row">
            <label for="signUpEmail">Email</label>
            <input id="signUpEmail" type="email" autocomplete="email" />
          </div>
          <div class="auth-row">
            <label for="signUpPassword">Password (min 6 characters)</label>
            <input id="signUpPassword" type="password" autocomplete="new-password" />
          </div>
          <div class="auth-actions">
            <button id="signUpBtn" class="btn btn-primary" type="button">Sign up</button>
          </div>
          <div class="auth-message" id="signUpMessage"></div>
        </div>

        <div class="auth-form" id="signInFormWrapper">
          <h3>Sign in</h3>
          <p class="auth-note">Use the same email + password you registered with.</p>
          <div class="auth-row">
            <label for="signInEmail">Email</label>
            <input id="signInEmail" type="email" autocomplete="email" />
          </div>
          <div class="auth-row">
            <label for="signInPassword">Password</label>
            <input id="signInPassword" type="password" autocomplete="current-password" />
          </div>
          <div class="auth-actions">
            <button id="signInBtn" class="btn btn-muted" type="button">Sign in</button>
          </div>
          <div class="auth-message" id="signInMessage"></div>
        </div>
      </div>
    </section>

    <main>
      <!-- LEFT: SUMMARY -->
      <section class="card relative" id="summaryCard">
        <div class="card-header">
          <div class="card-header-main">
            <h2>Today summary</h2>
            <span id="currentDateLabel"></span>
          </div>
          <div class="chip">
            <span class="chip-dot"></span>
            <span>Stored per user in Firestore</span>
          </div>
        </div>

        <div class="goal-row">
          <div class="field">
            <label for="dailyGoal">Daily calorie goal</label>
            <input id="dailyGoal" type="number" min="0" placeholder="e.g. 2200" />
          </div>
          <button id="saveGoalBtn" class="btn btn-primary" type="button">
            Save goal
          </button>
        </div>

        <div class="stats-row">
          <div class="stat">
            <div class="stat-label">Consumed</div>
            <div class="stat-value">
              <span id="statConsumed">0</span>
              <span class="stat-unit">kcal</span>
            </div>
            <div class="stat-sub" id="statConsumedCount">0 entries</div>
          </div>
          <div class="stat">
            <div class="stat-label">Remaining</div>
            <div class="stat-value">
              <span id="statRemaining">0</span>
              <span class="stat-unit">kcal</span>
            </div>
            <div class="stat-sub" id="statRemainingHint">Set a goal to see remaining</div>
          </div>
          <div class="stat">
            <div class="stat-label">Balance</div>
            <div class="stat-value">
              <span id="statBalance">0</span>
              <span class="stat-unit">kcal</span>
            </div>
            <div class="stat-sub" id="statBalanceHint">Goal − Consumed</div>
          </div>
        </div>

        <div class="summary-layout">
          <div class="ring">
            <svg width="120" height="120">
              <defs>
                <linearGradient id="ringGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#16a34a" />
                  <stop offset="100%" stop-color="#0ea5e9" />
                </linearGradient>
              </defs>
              <circle
                cx="60"
                cy="60"
                r="48"
                stroke="#e5e7eb"
                stroke-width="8"
                fill="none"
              ></circle>
              <circle
                id="progressCircle"
                cx="60"
                cy="60"
                r="48"
                stroke="url(#ringGradient)"
                stroke-width="8"
                stroke-linecap="round"
                fill="none"
                stroke-dasharray="301.59"
                stroke-dashoffset="301.59"
              ></circle>
            </svg>
            <div class="ring-center">
              <div class="ring-percent" id="progressPercent">0%</div>
              <div class="ring-label" id="progressLabel">of daily goal</div>
              <div class="ring-chip" id="progressBadge">Sign in and set a goal</div>
            </div>
          </div>

          <div class="info-stack">
            <div class="alert alert-info">
              <div class="alert-icon">ℹ</div>
              <p id="infoText">
                After you sign in, your daily goal and entries for each date are stored
                in your Firestore user document. Calories are estimated on-device by a
                small rule-based model. Verification emails may be in Spam/Junk.
              </p>
            </div>
            <div id="overGoalAlert" class="alert alert-danger" style="display:none;">
              <div class="alert-icon">!</div>
              <p id="overGoalText"></p>
            </div>
            <div class="legend-row">
              <div class="legend-item">
                <span class="legend-swatch swatch-consumed"></span>
                <span>Consumed</span>
              </div>
              <div class="legend-item">
                <span class="legend-swatch swatch-remaining"></span>
                <span>Remaining</span>
              </div>
            </div>
          </div>
        </div>

        <div class="footer-note">
          Change the date on the right to review or edit previous days.
        </div>
        <div class="disabled-overlay" id="summaryDisabledOverlay" style="display:flex;">
          Sign in to start tracking and saving your data in CalLog.
        </div>
      </section>

      <!-- RIGHT: LOG -->
      <section class="card relative" id="logCard">
        <div class="card-header">
          <div class="card-header-main">
            <h2>Log meals</h2>
            <span class="text-muted">Food name + grams → model estimates calories.</span>
          </div>
          <div class="date-row">
            <div class="date-picker">
              <span>Day</span>
              <input id="datePicker" type="date" />
            </div>
            <button id="clearDayBtn" class="btn-icon btn-danger" type="button">
              Clear day
            </button>
          </div>
        </div>

        <form id="entryForm" autocomplete="off">
          <div class="form-grid">
            <div class="field">
              <label for="mealName">Food / description</label>
              <input
                id="mealName"
                type="text"
                placeholder="e.g. chicken wrap, banana, pizza slice"
                required
              />
            </div>
            <div class="field">
              <label for="mealGrams">Portion (grams)</label>
              <input
                id="mealGrams"
                type="number"
                min="1"
                inputmode="numeric"
                placeholder="e.g. 120"
                required
              />
            </div>
            <div class="field">
              <label for="mealCategory">Category</label>
              <select id="mealCategory">
                <option value="auto">Auto detect</option>
                <option value="fruit">Fruit</option>
                <option value="vegetable">Vegetable</option>
                <option value="lean_protein">Lean protein</option>
                <option value="fatty_protein">Fatty protein</option>
                <option value="starch">Rice / pasta / potato</option>
                <option value="bread">Bread / baked</option>
                <option value="snack_sweet">Sweet snack / dessert</option>
                <option value="snack_savory">Chips / savory snack</option>
                <option value="fast_food">Fast food / mixed meal</option>
                <option value="cheese">Cheese</option>
                <option value="nuts">Nuts / seeds</option>
                <option value="drink_sugary">Sugary drink / juice</option>
                <option value="drink_zero">Zero-cal drink</option>
              </select>
            </div>
            <button class="btn btn-primary" type="submit">
              + Add
            </button>
          </div>
        </form>

        <div class="divider"></div>

        <div id="entriesList" class="entries-list"></div>
        <div id="emptyState" class="empty">
          No entries for this day yet. Add your first one above.
        </div>

        <div class="disabled-overlay" id="logDisabledOverlay" style="display:flex;">
          Sign in to create entries linked to your CalLog account.
        </div>
      </section>
    </main>
  </div>

  <script type="module">
    // Firebase SDK imports via CDN (modular v11 API)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      onAuthStateChanged,
      sendEmailVerification,
      signOut,
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      deleteDoc,
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    // Firebase configuration for CalLog (public client config)
    const firebaseConfig = {
      apiKey: "AIzaSyAhlSU9QQD9etz_lI9XPT0JDyx5NV6UUxg",
      authDomain: "callog-caltracker.firebaseapp.com",
      projectId: "callog-caltracker",
      storageBucket: "callog-caltracker.firebasestorage.app",
      messagingSenderId: "284680250030",
      appId: "1:284680250030:web:afb8694dfae211bd33c33f",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM refs (auth)
    const accountStatusEl = document.getElementById("accountStatus");
    const verifyPillEl = document.getElementById("verifyPill");
    const verifyDotEl = document.getElementById("verifyDot");
    const verifyLabelEl = document.getElementById("verifyLabel");
    const globalAuthMessageEl = document.getElementById("globalAuthMessage");
    const signedInActionsEl = document.getElementById("signedInActions");
    const signOutBtn = document.getElementById("signOutBtn");

    const signUpEmailEl = document.getElementById("signUpEmail");
    const signUpPasswordEl = document.getElementById("signUpPassword");
    const signUpBtn = document.getElementById("signUpBtn");
    const signUpMessageEl = document.getElementById("signUpMessage");

    const signInEmailEl = document.getElementById("signInEmail");
    const signInPasswordEl = document.getElementById("signInPassword");
    const signInBtn = document.getElementById("signInBtn");
    const signInMessageEl = document.getElementById("signInMessage");

    const authFormsEl = document.getElementById("authForms");

    // DOM refs (tracker)
    const dailyGoalInput = document.getElementById("dailyGoal");
    const saveGoalBtn = document.getElementById("saveGoalBtn");
    const resetAllBtn = document.getElementById("resetAllBtn");

    const statConsumedEl = document.getElementById("statConsumed");
    const statConsumedCountEl = document.getElementById("statConsumedCount");
    const statRemainingEl = document.getElementById("statRemaining");
    const statRemainingHintEl = document.getElementById("statRemainingHint");
    const statBalanceEl = document.getElementById("statBalance");
    const statBalanceHintEl = document.getElementById("statBalanceHint");

    const progressCircleEl = document.getElementById("progressCircle");
    const progressPercentEl = document.getElementById("progressPercent");
    const progressLabelEl = document.getElementById("progressLabel");
    const progressBadgeEl = document.getElementById("progressBadge");

    const infoTextEl = document.getElementById("infoText");
    const overGoalAlertEl = document.getElementById("overGoalAlert");
    const overGoalTextEl = document.getElementById("overGoalText");

    const currentDateLabelEl = document.getElementById("currentDateLabel");
    const datePickerEl = document.getElementById("datePicker");
    const clearDayBtn = document.getElementById("clearDayBtn");

    const entryForm = document.getElementById("entryForm");
    const mealNameInput = document.getElementById("mealName");
    const mealGramsInput = document.getElementById("mealGrams");
    const mealCategorySelect = document.getElementById("mealCategory");

    const entriesListEl = document.getElementById("entriesList");
    const emptyStateEl = document.getElementById("emptyState");

    const summaryDisabledOverlayEl = document.getElementById("summaryDisabledOverlay");
    const logDisabledOverlayEl = document.getElementById("logDisabledOverlay");

    const circleRadius = 48;
    const circleCircumference = 2 * Math.PI * circleRadius;

    let currentUser = null;
    let currentDate = null;
    let currentDayData = { goal: null, entries: [] };

    function todayISO() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    function formatDateLabel(dateStr) {
      const date = new Date(dateStr + "T00:00");
      const todayStr = todayISO();
      if (dateStr === todayStr) return "Today";
      const yest = new Date();
      yest.setDate(yest.getDate() - 1);
      const tomo = new Date();
      tomo.setDate(tomo.getDate() + 1);
      const iso = date.toISOString().slice(0, 10);
      if (iso === yest.toISOString().slice(0, 10)) return "Yesterday";
      if (iso === tomo.toISOString().slice(0, 10)) return "Tomorrow";
      return date.toLocaleDateString(undefined, {
        weekday: "short",
        month: "short",
        day: "numeric",
      });
    }

    function setCurrentDate(dateStr) {
      currentDate = dateStr;
      datePickerEl.value = dateStr;
      currentDateLabelEl.textContent = formatDateLabel(dateStr);
    }

    function getDayDocRef(uid, dateStr) {
      return doc(db, "users", uid, "days", dateStr);
    }

    function updateAuthUI(user) {
      if (!user) {
        accountStatusEl.textContent = "Not signed in.";
        verifyPillEl.style.display = "none";
        globalAuthMessageEl.textContent = "";
        signedInActionsEl.style.display = "none";
        authFormsEl.style.display = "grid";
        summaryDisabledOverlayEl.style.display = "flex";
        logDisabledOverlayEl.style.display = "flex";
        return;
      }

      const email = user.email || "(no email)";
      const verified = !!user.emailVerified;
      accountStatusEl.innerHTML = `Signed in as <strong>${email}</strong>`;
      verifyPillEl.style.display = "inline-flex";
      verifyDotEl.classList.toggle("ok", verified);
      verifyLabelEl.textContent = verified
        ? "Email verified"
        : "Verification email sent. Check your inbox (including Spam/Junk).";
      globalAuthMessageEl.textContent = "";
      signedInActionsEl.style.display = "flex";
      authFormsEl.style.display = "none";
      summaryDisabledOverlayEl.style.display = "none";
      logDisabledOverlayEl.style.display = "none";
    }

    function showAuthMessage(el, msg, type) {
      el.textContent = msg || "";
      el.classList.remove("error", "ok");
      if (type === "error") el.classList.add("error");
      if (type === "ok") el.classList.add("ok");
    }

    function isValidEmailFormat(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    // --------- SIMPLE CALORIE MODEL ---------

    const CATEGORY_PER100 = {
      fruit: 60,
      vegetable: 30,
      lean_protein: 165,
      fatty_protein: 250,
      starch: 140,
      bread: 250,
      snack_sweet: 430,
      snack_savory: 540,
      fast_food: 260,
      cheese: 380,
      nuts: 600,
      drink_sugary: 45,
      drink_zero: 1,
    };

    const KEYWORD_MODEL = [
      { words: ["banana"], per100: 89, basis: "banana (per 100 g)" },
      { words: ["apple"], per100: 52, basis: "apple (per 100 g)" },
      { words: ["orange"], per100: 47, basis: "orange (per 100 g)" },
      { words: ["strawberry", "strawberries"], per100: 33, basis: "strawberry (per 100 g)" },
      { words: ["grape", "grapes"], per100: 69, basis: "grapes (per 100 g)" },

      { words: ["chicken breast", "grilled chicken"], per100: 165, basis: "grilled chicken breast (per 100 g)" },
      { words: ["salmon"], per100: 208, basis: "salmon (per 100 g)" },
      { words: ["beef", "steak"], per100: 250, basis: "beef (per 100 g)" },

      { words: ["rice"], per100: 130, basis: "cooked white rice (per 100 g)" },
      { words: ["brown rice"], per100: 111, basis: "cooked brown rice (per 100 g)" },
      { words: ["pasta"], per100: 160, basis: "cooked pasta (per 100 g)" },
      { words: ["potato", "fries", "fry"], per100: 190, basis: "fried potatoes (per 100 g)" },

      { words: ["bread"], per100: 260, basis: "bread (per 100 g)" },
      { words: ["pizza"], per100: 270, basis: "pizza (per 100 g)" },
      { words: ["burger"], per100: 260, basis: "burger (per 100 g)" },

      { words: ["chips", "crisps"], per100: 540, basis: "potato chips (per 100 g)" },
      { words: ["cookie", "cookies"], per100: 480, basis: "cookies (per 100 g)" },
      { words: ["chocolate"], per100: 540, basis: "milk chocolate (per 100 g)" },

      { words: ["coke", "cola", "soda"], per100: 40, basis: "sugary soft drink (per 100 g)" },
      { words: ["juice"], per100: 45, basis: "fruit juice (per 100 g)" },
      { words: ["coffee", "tea"], per100: 2, basis: "plain coffee/tea (per 100 g)" },

      { words: ["cheese"], per100: 380, basis: "cheese (per 100 g)" },
      { words: ["peanut", "peanuts", "peanut butter"], per100: 588, basis: "peanuts / peanut butter (per 100 g)" },
      { words: ["almond", "almonds"], per100: 575, basis: "almonds (per 100 g)" },
    ];

    function detectCategoryFromText(text) {
      const t = text.toLowerCase();
      if (t.match(/banana|apple|orange|strawber|grape/)) return "fruit";
      if (t.match(/broccoli|carrot|lettuce|salad|spinach|cucumber/)) return "vegetable";
      if (t.match(/chicken|turkey|tuna|cod/)) return "lean_protein";
      if (t.match(/salmon|pork belly|bacon/)) return "fatty_protein";
      if (t.match(/rice|pasta|noodle|potato|mashed/)) return "starch";
      if (t.match(/bread|bun|bagel|toast/)) return "bread";
      if (t.match(/cake|cookie|ice cream|brownie|donut|muffin/)) return "snack_sweet";
      if (t.match(/chips|crisps|nacho|pretzel/)) return "snack_savory";
      if (t.match(/pizza|burger|fries|kebab|shawarma/)) return "fast_food";
      if (t.match(/cheese/)) return "cheese";
      if (t.match(/peanut|almond|walnut|cashew|nut/)) return "nuts";
      if (t.match(/juice|soda|cola|coke|sprite|fanta|energy drink/)) return "drink_sugary";
      if (t.match(/diet|zero sugar|zero-cal|zero cal/)) return "drink_zero";
      return "fast_food";
    }

    function estimateCalories(name, grams, userCategory) {
      const text = name.toLowerCase();

      let keywordMatch = null;
      for (const rule of KEYWORD_MODEL) {
        if (rule.words.some((w) => text.includes(w))) {
          keywordMatch = rule;
          break;
        }
      }

      const category =
        userCategory && userCategory !== "auto"
          ? userCategory
          : detectCategoryFromText(text);

      let per100 = null;
      let basis = "";

      if (keywordMatch) {
        per100 = keywordMatch.per100;
        basis = keywordMatch.basis;
      } else if (CATEGORY_PER100[category] != null) {
        per100 = CATEGORY_PER100[category];
        basis = "category: " + category.replace("_", " ");
      } else {
        per100 = 220;
        basis = "generic mixed meal";
      }

      const kcal = Math.round((per100 * grams) / 100);
      return {
        calories: kcal,
        per100: per100,
        category,
        basis,
      };
    }

    function renderEntries() {
      const entries = currentDayData.entries || [];
      entriesListEl.innerHTML = "";
      if (entries.length === 0) {
        emptyStateEl.style.display = "block";
        return;
      }
      emptyStateEl.style.display = "none";

      entries
        .slice()
        .sort((a, b) => a.id.localeCompare(b.id))
        .forEach((entry) => {
          const root = document.createElement("div");
          root.className = "entry";

          const main = document.createElement("div");
          main.className = "entry-main";

          const nameEl = document.createElement("div");
          nameEl.className = "entry-name";
          nameEl.textContent = entry.name || "(no description)";
          main.appendChild(nameEl);

          const meta = document.createElement("div");
          meta.className = "entry-meta";

          const gramsBadge = document.createElement("span");
          gramsBadge.className = "badge-pill";
          gramsBadge.textContent = (entry.grams || 0) + " g";
          meta.appendChild(gramsBadge);

          if (entry.category && entry.category !== "auto") {
            const catBadge = document.createElement("span");
            catBadge.className = "badge-pill";
            catBadge.textContent = entry.category.replace("_", " ");
            meta.appendChild(catBadge);
          }

          if (entry.modelBasis) {
            const basisBadge = document.createElement("span");
            basisBadge.className = "badge-pill";
            basisBadge.textContent = entry.modelBasis;
            meta.appendChild(basisBadge);
          }

          main.appendChild(meta);

          const calEl = document.createElement("div");
          calEl.className = "entry-calories";
          calEl.textContent = (entry.calories || 0) + " kcal";

          const actions = document.createElement("div");
          actions.className = "entry-actions";

          const fineTuneBtn = document.createElement("button");
          fineTuneBtn.className = "btn-icon";
          fineTuneBtn.type = "button";
          fineTuneBtn.textContent = "Adjust";
          fineTuneBtn.addEventListener("click", async () => {
            const current = entry.calories || 0;
            const v = prompt("Adjust calories for this entry:", String(current));
            if (v == null) return;
            const num = Number(v);
            if (!Number.isFinite(num) || num <= 0) return;
            entry.calories = Math.round(num);
            await saveCurrentDay();
            updateStatsAndUI();
          });

          const deleteBtn = document.createElement("button");
          deleteBtn.className = "btn-icon btn-danger";
          deleteBtn.type = "button";
          deleteBtn.textContent = "Delete";
          deleteBtn.addEventListener("click", async () => {
            currentDayData.entries = (currentDayData.entries || []).filter(
              (e) => e.id !== entry.id,
            );
            await saveCurrentDay();
            updateStatsAndUI();
          });

          actions.appendChild(fineTuneBtn);
          actions.appendChild(deleteBtn);

          root.appendChild(main);
          root.appendChild(calEl);
          root.appendChild(actions);

          entriesListEl.appendChild(root);
        });
    }

    function updateStatsAndUI() {
      const entries = currentDayData.entries || [];
      const total = entries.reduce((sum, e) => sum + (e.calories || 0), 0);

      statConsumedEl.textContent = String(total);
      statConsumedCountEl.textContent =
        entries.length === 1 ? "1 entry" : entries.length + " entries";

      const dayGoal =
        typeof currentDayData.goal === "number" && currentDayData.goal > 0
          ? currentDayData.goal
          : null;

      if (dayGoal) {
        dailyGoalInput.value = String(dayGoal);
        const remaining = Math.max(dayGoal - total, 0);
        const balance = dayGoal - total;

        statRemainingEl.textContent = String(remaining);
        statRemainingHintEl.textContent =
          remaining === 0
            ? "Goal reached or exceeded"
            : "You can still consume " + remaining + " kcal";

        statBalanceEl.textContent = String(balance);
        statBalanceHintEl.textContent =
          balance >= 0 ? "Under daily goal" : "Over daily goal";

        const progress = total <= 0 ? 0 : Math.min((total / dayGoal) * 100, 200);
        const percentText = Math.round(Math.min((total / dayGoal) * 100, 999));
        const offset = circleCircumference * (1 - Math.min(progress / 100, 1));
        progressCircleEl.style.strokeDasharray = circleCircumference.toFixed(2);
        progressCircleEl.style.strokeDashoffset = offset.toFixed(2);
        progressPercentEl.textContent = percentText + "%";
        progressLabelEl.textContent = "of " + dayGoal + " kcal goal";

        if (total === 0) {
          progressBadgeEl.textContent = "Start logging meals to see progress.";
        } else if (progress < 70) {
          progressBadgeEl.textContent = "Plenty of room left today.";
        } else if (progress <= 100) {
          progressBadgeEl.textContent = "You’re close to your goal.";
        } else {
          progressBadgeEl.textContent = "You’re above today’s goal.";
        }

        if (balance < 0) {
          overGoalTextEl.textContent =
            "You are " + Math.abs(balance) + " kcal over your daily goal for this day.";
          overGoalAlertEl.style.display = "flex";
        } else {
          overGoalAlertEl.style.display = "none";
        }

        infoTextEl.innerHTML =
          "Goal and entries for each date are stored under your user in Firestore. Calories come from a small, built-in rule-based model; you can fine-tune each entry if needed. Verification emails may be in Spam/Junk.";
      } else {
        statRemainingEl.textContent = "0";
        statRemainingHintEl.textContent = "Set a goal to see remaining";
        statBalanceEl.textContent = "0";
        statBalanceHintEl.textContent = "Goal − Consumed";

        progressCircleEl.style.strokeDasharray = circleCircumference.toFixed(2);
        progressCircleEl.style.strokeDashoffset = circleCircumference.toFixed(2);
        progressPercentEl.textContent = "0%";
        progressLabelEl.textContent = "of daily goal";
        progressBadgeEl.textContent = "Set a goal to begin";
        overGoalAlertEl.style.display = "none";

        infoTextEl.innerHTML =
          "You can log food without a goal. Everything is saved against your CalLog Firestore user; the model estimates calories automatically from your inputs. Verification emails may be in Spam/Junk.";
      }

      renderEntries();
    }

    async function loadDayForCurrentUser(dateStr) {
      if (!currentUser) return;
      const ref = getDayDocRef(currentUser.uid, dateStr);
      const snap = await getDoc(ref);
      if (snap.exists()) {
        const data = snap.data();
        currentDayData = {
          goal: typeof data.goal === "number" ? data.goal : null,
          entries: Array.isArray(data.entries) ? data.entries : [],
        };
      } else {
        currentDayData = { goal: null, entries: [] };
      }
      updateStatsAndUI();
    }

    async function saveCurrentDay() {
      if (!currentUser || !currentDate) return;
      const ref = getDayDocRef(currentUser.uid, currentDate);
      const payload = {
        goal:
          typeof currentDayData.goal === "number" && currentDayData.goal > 0
            ? currentDayData.goal
            : null,
        entries: Array.isArray(currentDayData.entries)
          ? currentDayData.entries
          : [],
        updatedAt: new Date(),
      };
      await setDoc(ref, payload, { merge: true });
    }

    // --------- AUTH EVENT HANDLERS ---------

    signUpBtn.addEventListener("click", async () => {
      const email = signUpEmailEl.value.trim();
      const password = signUpPasswordEl.value;
      showAuthMessage(signUpMessageEl, "", "");
      if (!isValidEmailFormat(email)) {
        showAuthMessage(signUpMessageEl, "Enter a valid email address.", "error");
        return;
      }
      if (!password || password.length < 6) {
        showAuthMessage(
          signUpMessageEl,
          "Password must be at least 6 characters.",
          "error",
        );
        return;
      }
      try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        await sendEmailVerification(cred.user);
        showAuthMessage(
          signUpMessageEl,
          "Account created. A verification email has been sent — check your Spam/Junk folder if you don’t see it.",
          "ok",
        );
        showAuthMessage(
          globalAuthMessageEl,
          "Check your inbox (including Spam/Junk) and click the verification link.",
          "ok",
        );
      } catch (err) {
        const msg = err?.message || "Sign-up failed.";
        showAuthMessage(signUpMessageEl, msg, "error");
      }
    });

    signInBtn.addEventListener("click", async () => {
      const email = signInEmailEl.value.trim();
      const password = signInPasswordEl.value;
      showAuthMessage(signInMessageEl, "", "");
      try {
        await signInWithEmailAndPassword(auth, email, password);
        showAuthMessage(signInMessageEl, "Signed in.", "ok");
      } catch (err) {
        const msg = err?.message || "Sign-in failed.";
        showAuthMessage(signInMessageEl, msg, "error");
      }
    });

    signOutBtn.addEventListener("click", async () => {
      try {
        await signOut(auth);
      } catch (err) {
        showAuthMessage(globalAuthMessageEl, "Sign-out failed.", "error");
      }
    });

    resetAllBtn.addEventListener("click", async () => {
      if (!currentUser) return;
      const confirmed = confirm(
        "This will delete the current day document in Firestore for this user. You cannot undo this. Continue?",
      );
      if (!confirmed) return;
      try {
        const ref = getDayDocRef(currentUser.uid, currentDate || todayISO());
        await deleteDoc(ref);
        currentDayData = { goal: null, entries: [] };
        updateStatsAndUI();
        showAuthMessage(
          globalAuthMessageEl,
          "Current day cleared from your CalLog account.",
          "ok",
        );
      } catch (err) {
        showAuthMessage(globalAuthMessageEl, "Failed to clear day.", "error");
      }
    });

    // --------- TRACKER EVENTS ---------

    saveGoalBtn.addEventListener("click", async () => {
      if (!currentUser) return;
      const v = dailyGoalInput.value.trim();
      if (!v) {
        currentDayData.goal = null;
      } else {
        const n = Number(v);
        if (!Number.isFinite(n) || n <= 0) {
          dailyGoalInput.focus();
          return;
        }
        currentDayData.goal = Math.round(n);
      }
      await saveCurrentDay();
      updateStatsAndUI();
    });

    entryForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!currentUser) return;
      const name = mealNameInput.value.trim();
      const grams = Number(mealGramsInput.value);
      const category = mealCategorySelect.value || "auto";
      if (!name) {
        mealNameInput.focus();
        return;
      }
      if (!Number.isFinite(grams) || grams <= 0) {
        mealGramsInput.focus();
        return;
      }

      const est = estimateCalories(name, grams, category);
      const entry = {
        id: Date.now().toString(36) + Math.random().toString(36).slice(2, 6),
        date: currentDate,
        name: name,
        grams: Math.round(grams),
        calories: est.calories,
        category: est.category,
        modelBasis: est.basis + " · " + est.per100 + " kcal / 100 g",
      };

      if (!Array.isArray(currentDayData.entries)) currentDayData.entries = [];
      currentDayData.entries.push(entry);
      await saveCurrentDay();
      updateStatsAndUI();

      mealNameInput.value = "";
      mealGramsInput.value = "";
      mealCategorySelect.value = "auto";
      mealNameInput.focus();
    });

    clearDayBtn.addEventListener("click", async () => {
      if (!currentUser) return;
      if (!currentDayData.entries || currentDayData.entries.length === 0) return;
      const confirmed = confirm(
        "Delete all entries for " + formatDateLabel(currentDate) + "? This cannot be undone.",
      );
      if (!confirmed) return;
      currentDayData.entries = [];
      await saveCurrentDay();
      updateStatsAndUI();
    });

    datePickerEl.addEventListener("change", async () => {
      if (!datePickerEl.value) {
        datePickerEl.value = todayISO();
      }
      const newDate = datePickerEl.value;
      setCurrentDate(newDate);
      if (currentUser) {
        await loadDayForCurrentUser(newDate);
      } else {
        currentDayData = { goal: null, entries: [] };
        updateStatsAndUI();
      }
    });

    // --------- INIT / AUTH STATE ---------

    function initDates() {
      const today = todayISO();
      setCurrentDate(today);
      datePickerEl.value = today;
    }

    onAuthStateChanged(auth, async (user) => {
      currentUser = user;
      updateAuthUI(user);
      if (user) {
        initDates();
        await loadDayForCurrentUser(currentDate);
      } else {
        currentDayData = { goal: null, entries: [] };
        updateStatsAndUI();
      }
    });

    initDates();
    updateStatsAndUI();
  </script>
</body>
</html>
